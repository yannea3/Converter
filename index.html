<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Baking Helper</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
      line-height: 1.6;
    }
    h1, h2 {
      text-align: center;
    }
    label {
      font-weight: bold;
    }
    input, select, button {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      margin-bottom: 15px;
    }
    .section {
      margin-bottom: 40px;
    }
    .result {
      font-weight: bold;
      font-size: 1.2em;
    }
  </style>
</head>
<body>

  <h1>Baking Helper</h1>

  <!-- Unit Converter -->
  <div class="section">
    <h2>Unit Converter</h2>
    <label for="unitValue">Enter value:</label>
    <input type="number" id="unitValue" step="any" placeholder="e.g. 1100">

    <label for="unitFrom">Convert from:</label>
    <select id="unitFrom">
      <option value="grams">Grams</option>
      <option value="ml">Milliliters</option>
      <option value="cups">Cups</option>
      <option value="tbsp">Tablespoons</option>
      <option value="tsp">Teaspoons</option>
    </select>

    <label for="unitTo">Convert to:</label>
    <select id="unitTo">
      <option value="grams">Grams</option>
      <option value="ml">Milliliters</option>
      <option value="cups">Cups</option>
      <option value="tbsp">Tablespoons</option>
      <option value="tsp">Teaspoons</option>
    </select>

    <label for="ingredient">Ingredient (for density):</label>
    <select id="ingredient">
      <option value="flour">Flour</option>
      <option value="sugar">Sugar</option>
      <option value="butter">Butter</option>
      <option value="water">Water</option>
      <option value="milk">Milk</option>
    </select>

    <button onclick="convert()">Convert</button>
    <p class="result" id="conversionResult"></p>
  </div>

  <!-- Recipe Scaler -->
  <div class="section">
    <h2>Recipe Scaler</h2>
    <p>This tool scales your full recipe based on the ingredient you have limited quantity of.</p>

    <div id="ingredientList">
      <p><strong>Step 1: Enter your original recipe</strong></p>
    </div>
    <button onclick="addIngredient()">+ Add Ingredient</button>

    <div style="margin-top: 20px;">
      <p><strong>Step 2: Select the ingredient youâ€™re low on</strong></p>
      <label for="limitIngredient">Limit by ingredient:</label>
      <select id="limitIngredient">
        <option value="">-- Select Ingredient --</option>
      </select>

      <label for="limitAmount">How much of it do you have?</label>
      <input type="number" id="limitAmount" placeholder="e.g. 400" />
    </div>

    <button onclick="scaleRecipe()">Scale Recipe</button>
    <p class="result" id="scaledRecipe"></p>

    <div id="breadEstimatorSection" style="display: none;">
      <h3>Estimate Bread Pieces</h3>
      <label for="breadWeightInput">Average weight per bread (g):</label>
      <input type="number" id="breadWeightInput" placeholder="e.g. 60" />

      <label for="customDoughWeight">Optional: Custom total dough weight for scaled recipe (g):</label>
      <input type="number" id="customDoughWeight" placeholder="Leave blank to auto-calculate" />

      <button onclick="estimateBreadPieces()">Estimate</button>
      <p class="result" id="breadPieceEstimate"></p>
    </div>
  </div>

  <script>
    const ingredientNames = [
      "Flour (g)", "Yeast (g)", "Sugar (g)", "Salt (g)",
      "Water (ml)", "Shortening (g)", "Milk (ml)", "Oil (ml)", "Butter (g)"
    ];

    function addIngredient() {
      const container = document.createElement("div");
      container.classList.add("ingredient-item");

      const select = document.createElement("select");
      ingredientNames.forEach(name => {
        const option = document.createElement("option");
        option.value = name;
        option.textContent = name;
        select.appendChild(option);
      });

      const input = document.createElement("input");
      input.type = "number";
      input.placeholder = "Original amount";

      container.appendChild(select);
      container.appendChild(input);
      document.getElementById("ingredientList").appendChild(container);

      const limitSelect = document.getElementById("limitIngredient");
      const newOption = document.createElement("option");
      newOption.value = ingredientNames[0];
      newOption.textContent = ingredientNames[0];
      select.addEventListener("change", () => {
        newOption.value = select.value;
        newOption.textContent = select.value;
      });
      limitSelect.appendChild(newOption);
    }

    function scaleRecipe() {
      const limitName = document.getElementById("limitIngredient").value;
      const limitAmount = parseFloat(document.getElementById("limitAmount").value);
      const items = document.querySelectorAll(".ingredient-item");

      if (!limitName || isNaN(limitAmount) || limitAmount <= 0) {
        document.getElementById("scaledRecipe").innerText = "Please select a valid ingredient and amount.";
        return;
      }

      let originalAmount = null;
      const ingredients = [];

      items.forEach(item => {
        const name = item.querySelector("select").value;
        const amount = parseFloat(item.querySelector("input").value);

        if (!isNaN(amount) && name) {
          ingredients.push({ name, amount });
          if (name === limitName) {
            originalAmount = amount;
          }
        }
      });

      if (originalAmount === null) {
        document.getElementById("scaledRecipe").innerText = "The limiting ingredient must be part of the original recipe.";
        return;
      }

      const factor = limitAmount / originalAmount;
      let output = `<strong>Adjusted Ingredients:</strong><br>`;

      ingredients.forEach(ing => {
        const scaled = (ing.amount * factor).toFixed(1);
        output += `- ${ing.name}: ${scaled}<br>`;
      });

      document.getElementById("scaledRecipe").innerHTML = output;
      showBreadEstimator();
    }

  function estimateBreadPieces() {
  const breadWeight = parseFloat(document.getElementById("breadWeightInput").value);
  const customDoughWeight = parseFloat(document.getElementById("customDoughWeight").value);

  if (!breadWeight || breadWeight <= 0) {
    document.getElementById("breadPieceEstimate").innerText = "Please enter a valid bread weight.";
    return;
  }

  const scaledOutput = document.getElementById("scaledRecipe").innerHTML;

  // Extract adjusted ingredient weights from the scaled output
  let totalScaledWeight = 0;
  const lines = scaledOutput.split("<br>");
  lines.forEach(line => {
    const match = line.match(/- .+?: ([\d.]+)\s?(g|ml)/i);
    if (match) {
      const value = parseFloat(match[1]);
      if (!isNaN(value)) totalScaledWeight += value;
    }
  });

  const estimatedScaledWeight = isNaN(customDoughWeight) || customDoughWeight <= 0
    ? totalScaledWeight
    : customDoughWeight;

  const scaledPieces = Math.floor(estimatedScaledWeight / breadWeight);

  // Estimate original dough weight
  const items = document.querySelectorAll(".ingredient-item");
  let originalTotal = 0;
  items.forEach(item => {
    const amount = parseFloat(item.querySelector("input").value);
    if (!isNaN(amount)) {
      originalTotal += amount;
    }
  });

  const originalPieces = Math.floor(originalTotal / breadWeight);

  document.getElementById("breadPieceEstimate").innerText =
    `Original Recipe: ~${originalPieces} pcs\nScaled Recipe: ~${scaledPieces} pcs (based on ${breadWeight}g each)`;
}

      function extractWeightFromHtml(html) {
        let total = 0;
        const matches = html.match(/: ([\d.]+)\s?(g|ml)/gi);
        if (matches) {
          matches.forEach(m => {
            const num = parseFloat(m);
            if (!isNaN(num)) total += num;
          });
        }
        return total;
      }

      const estimatedScaledWeight = isNaN(customDoughWeight) || customDoughWeight <= 0
        ? extractWeightFromHtml(scaledOutput)
        : customDoughWeight;

      const scaledPieces = Math.floor(estimatedScaledWeight / breadWeight);

      const items = document.querySelectorAll(".ingredient-item");
      let originalTotal = 0;
      items.forEach(item => {
        const amount = parseFloat(item.querySelector("input").value);
        if (!isNaN(amount)) {
          originalTotal += amount;
        }
      });

      const originalPieces = Math.floor(originalTotal / breadWeight);

      document.getElementById("breadPieceEstimate").innerText =
        `Original Recipe: ~${originalPieces} pcs\nScaled Recipe: ~${scaledPieces} pcs (based on ${breadWeight}g each)`;
    }

    function showBreadEstimator() {
      document.getElementById("breadEstimatorSection").style.display = "block";
    }

    function decimalToFraction(value) {
      const tolerance = 1e-2;
      let h1 = 1, h2 = 0, k1 = 0, k2 = 1;
      let b = value;
      do {
        let a = Math.floor(b);
        let aux = h1; h1 = a * h1 + h2; h2 = aux;
        aux = k1; k1 = a * k1 + k2; k2 = aux;
        b = 1 / (b - a);
      } while (Math.abs(value - h1 / k1) > value * tolerance);
      if (k1 <= 9) return `${h1}/${k1}`;
      return null;
    }

    function convert() {
      const value = parseFloat(document.getElementById('unitValue').value);
      const from = document.getElementById('unitFrom').value;
      const to = document.getElementById('unitTo').value;
      const ingredient = document.getElementById('ingredient').value;

      if (isNaN(value) || value <= 0) {
        document.getElementById("conversionResult").innerText = "Please enter a valid amount.";
        return;
      }

      const densities = {
        flour: 0.53,
        sugar: 0.85,
        butter: 0.96,
        water: 1.00,
        milk: 1.03
      };

      const volumeUnits = {
        ml: 1,
        cups: 240,
        tbsp: 15,
        tsp: 5
      };

      let result = 0;

      if (from === to) {
        result = value;
      } else if (from === "grams" && to in volumeUnits) {
        const mlValue = value / densities[ingredient];
        result = mlValue / volumeUnits[to];
      } else if (to === "grams" && from in volumeUnits) {
        const mlValue = value * volumeUnits[from];
        result = mlValue * densities[ingredient];
      } else if (from in volumeUnits && to in volumeUnits) {
        const mlValue = value * volumeUnits[from];
        result = mlValue / volumeUnits[to];
      } else {
        document.getElementById("conversionResult").innerText = "Unsupported conversion.";
        return;
      }

      const fraction = decimalToFraction(result);
      const useFraction = fraction && fraction.indexOf("/") === 1;
      const display = useFraction
        ? `${result.toFixed(2)} or ${fraction} ${to}`
        : `${result.toFixed(2)} ${to}`;

      document.getElementById("conversionResult").innerText = `Result: ${display}`;
    }
  </script>

</body>
</html>
